// SPDX-License-Identifier: MIT

pragma solidity ^0.8.21;

import "lib/forge-std/src/StdJson.sol";
import { PasskeyVerifier } from "contracts/verifiers/PasskeyVerifier.sol";
import { Script, console2 as console } from "lib/forge-std/src/Script.sol";

contract DeployPasskeyVerifier is Script {
    address constant PASSKEY_VERIFIER = 0x51019BcD8AA3D75fC91828E5814Fbbd06fa7e158;
    address private CREATE2_DEPLOYER = 0x4e59b44847b379578588920cA78FbF26c0B4956C;

    function run() public {
        vm.startBroadcast();

        bytes memory data = hex"000000000000000000000000000000000000000000000000000000017885423a608060405234801561000f575f80fd5b50610bf08061001d5f395ff3fe608060405234801561000f575f80fd5b5060043610610034575f3560e01c80638cbf00dd14610038578063de12c6401461004c575b5f80fd5b604051600181526020015b60405180910390f35b61005f61005a366004610887565b61006f565b6040519015158152602001610043565b5f80808080808080806100848a8c018c6109a3565b975097509750975097509750975097505f61009f8383610106565b90508d81146100b9575f99505050505050505050506100fe565b5f8d6040516020016100cd91815260200190565b60405160208183030381529060405290506100f1818b60018c8c8c8c8c8c8c610135565b9a50505050505050505050505b949350505050565b604080516020808201859052818301849052825180830384018152606090920190925280519101205b92915050565b5f60258a51108061016e575061016c8a60208151811061015757610157610a4a565b01602001516001600160f81b0319168a6102eb565b155b1561017a57505f6102dd565b604080518082019091526015815274113a3cb832911d113bb2b130baba34371733b2ba1160591b60208201526101b1818a8961034d565b6101be575f9150506102dd565b5f6101c88d610405565b90505f816040516020016101dc9190610a80565b60405160208183030381529060405290506101f8818c8c61034d565b610207575f93505050506102dd565b5f60028c6040516102189190610ac0565b602060405180830381855afa158015610233573d5f803e3d5ffd5b5050506040513d601f19601f820116820180604052508101906102569190610adb565b90505f60028f8360405160200161026e929190610af2565b60408051601f198184030181529082905261028891610ac0565b602060405180830381855afa1580156102a3573d5f803e3d5ffd5b5050506040513d601f19601f820116820180604052508101906102c69190610adb565b90506102d5818b8b8b8b610614565b955050505050505b9a9950505050505050505050565b5f600160f81b8381161461030057505f61012f565b8180156103135750600160fa1b83811614155b1561031f57505f61012f565b600160fb1b8381161461034457600f60fc1b600160fc1b84160161034457505f61012f565b50600192915050565b825182515f918591859190845b828110156103f4578161036d8289610b27565b1061037f575f955050505050506103fe565b8361038a8289610b27565b8151811061039a5761039a610a4a565b602001015160f81c60f81b6001600160f81b0319168582815181106103c1576103c1610a4a565b01602001516001600160f81b031916146103e2575f955050505050506103fe565b806103ec81610b3a565b91505061035a565b5060019450505050505b9392505050565b60605f6104118361065a565b90505f8190505f6002825111801561045a575081600283516104339190610b52565b8151811061044357610443610a4a565b6020910101516001600160f81b031916603d60f81b145b15610467575060026104b2565b600182511180156104a9575081600183516104829190610b52565b8151811061049257610492610a4a565b6020910101516001600160f81b031916603d60f81b145b156104b2575060015b5f8183516104c09190610b52565b90505f816001600160401b038111156104db576104db6108ff565b6040519080825280601f01601f191660200182016040528015610505576020820181803683370190505b5090505f5b828110156106095784818151811061052457610524610a4a565b01602001516001600160f81b031916602b60f81b0361056f57602d60f81b82828151811061055457610554610a4a565b60200101906001600160f81b03191690815f1a9053506105f7565b84818151811061058157610581610a4a565b01602001516001600160f81b031916602f60f81b036105b157605f60f81b82828151811061055457610554610a4a565b8481815181106105c3576105c3610a4a565b602001015160f81c60f81b8282815181106105e0576105e0610a4a565b60200101906001600160f81b03191690815f1a9053505b8061060181610b3a565b91505061050a565b509695505050505050565b5f6f218c82a92c7430bd86231a9e81ce6d5867ffffffff0000000160bf1b0384111561064157505f610651565b61064e86868686866107a8565b90505b95945050505050565b606081515f0361067757505060408051602081019091525f815290565b5f604051806060016040528060408152602001610bb06040913990505f6003845160026106a49190610b27565b6106ae9190610b65565b6106b9906004610b84565b6001600160401b038111156106d0576106d06108ff565b6040519080825280601f01601f1916602001820160405280156106fa576020820181803683370190505b509050600182016020820185865187015b80821015610766576003820191508151603f8160121c168501518453600184019350603f81600c1c168501518453600184019350603f8160061c168501518453600184019350603f811685015184535060018301925061070b565b505060038651066001811461078257600281146107955761079d565b603d6001830353603d600283035361079d565b603d60018303535b509195945050505050565b6040805160208101879052908101859052606081018490526080810183905260a081018290525f90819060c00160405160208183030381529060405290505f8073c2b78104907f722dabac4c69f826a522b2754de46001600160a01b0316836040516108149190610ac0565b5f60405180830381855afa9150503d805f811461084c576040519150601f19603f3d011682016040523d82523d5f602084013e610851565b606091505b50915091508161086357610863610b9b565b808060200190518101906108779190610adb565b6001149998505050505050505050565b5f805f806060858703121561089a575f80fd5b843593506020850135925060408501356001600160401b03808211156108be575f80fd5b818701915087601f8301126108d1575f80fd5b8135818111156108df575f80fd5b8860208285010111156108f0575f80fd5b95989497505060200194505050565b634e487b7160e01b5f52604160045260245ffd5b5f6001600160401b038084111561092c5761092c6108ff565b604051601f8501601f19908116603f01168101908282118183101715610954576109546108ff565b8160405280935085815286868601111561096c575f80fd5b858560208301375f602087830101525050509392505050565b5f82601f830112610994575f80fd5b6103fe83833560208501610913565b5f805f805f805f80610100898b0312156109bb575f80fd5b88356001600160401b03808211156109d1575f80fd5b818b0191508b601f8301126109e4575f80fd5b6109f38c833560208501610913565b995060208b0135915080821115610a08575f80fd5b50610a158b828c01610985565b989b989a505050506040870135966060810135966080820135965060a0820135955060c0820135945060e09091013592509050565b634e487b7160e01b5f52603260045260245ffd5b5f5b83811015610a78578181015183820152602001610a60565b50505f910152565b6c1131b430b63632b733b2911d1160991b815281515f90610aa881600d850160208701610a5e565b601160f91b600d939091019283015250600e01919050565b5f8251610ad1818460208701610a5e565b9190910192915050565b5f60208284031215610aeb575f80fd5b5051919050565b5f8351610b03818460208801610a5e565b9190910191825250602001919050565b634e487b7160e01b5f52601160045260245ffd5b8082018082111561012f5761012f610b13565b5f60018201610b4b57610b4b610b13565b5060010190565b8181038181111561012f5761012f610b13565b5f82610b7f57634e487b7160e01b5f52601260045260245ffd5b500490565b808202811582820484141761012f5761012f610b13565b634e487b7160e01b5f52600160045260245ffdfe4142434445464748494a4b4c4d4e4f505152535455565758595a6162636465666768696a6b6c6d6e6f707172737475767778797a303132333435363738392b2f";

        (bool s, bytes memory r) = CREATE2_DEPLOYER.call{ value: 0 }(data);
        vm.stopBroadcast();

        require(s, "Failed to send TX");
        console.log(vm.toString(r));
        address deployedAddress = address(uint160(bytes20(r)));
        console.log("Deployed to:", deployedAddress);
        require(
            PASSKEY_VERIFIER == deployedAddress, "Not Same Address: 0x51019BcD8AA3D75fC91828E5814Fbbd06fa7e158"
        );

        vm.stopBroadcast();
    }
}
