// SPDX-License-Identifier: MIT

pragma solidity ^0.8.29;

import "lib/forge-std/src/StdJson.sol";
import { Script, console2 as console } from "lib/forge-std/src/Script.sol";
import { Simple7702Recovery } from "contracts/mocks/Simple7702Recovery.sol";

contract DeploySimple7702Recovery is Script {
    bytes32 constant salt = 0x000000000000000000000000000000000000000000000000000000017885423a;
    address private CREATE2_DEPLOYER = 0x4e59b44847b379578588920cA78FbF26c0B4956C;
    address constant SIMPLE_7702 = 0xE70De37053A64B5B2143DA328b5F6DAF8821cbCd;

    function run() public {
        vm.startBroadcast();

        bytes memory data =
            hex"000000000000000000000000000000000000000000000000000000017885423a60a0604052348015600e575f5ffd5b506040516114e93803806114e9833981016040819052602b91603b565b6001600160a01b03166080526066565b5f60208284031215604a575f5ffd5b81516001600160a01b0381168114605f575f5ffd5b9392505050565b60805161146b61007e5f395f61065a015261146b5ff3fe6080604052600436106100cc575f3560e01c80629539c7146100ce57806301ffc9a71461011a578063150b7a02146101395780631626ba7e1461017c57806319822f7c1461019b57806334fcd5be146101c8578063880e9cd7146101e75780638ccc84bc1461021d5780638da5cb5b1461023c578063a70e91941461024e578063b0d691fe14610276578063b61d27f61461028a578063bc197c81146102a9578063d087d288146102d4578063e49d7870146102e8578063f23a6e6114610307578063f8d1ff4614610332575b005b3480156100d9575f5ffd5b506101056100e8366004610c40565b6001600160a01b03165f9081526003602052604090205460ff1690565b60405190151581526020015b60405180910390f35b348015610125575f5ffd5b50610105610134366004610c59565b610351565b348015610144575f5ffd5b50610163610153366004610d57565b630a85bd0160e11b949350505050565b6040516001600160e01b03199091168152602001610111565b348015610187575f5ffd5b50610163610196366004610dba565b6103d8565b3480156101a6575f5ffd5b506101ba6101b5366004610dfd565b610405565b604051908152602001610111565b3480156101d3575f5ffd5b506100cc6101e2366004610e4b565b610423565b3480156101f2575f5ffd5b505f54610205906001600160a01b031681565b6040516001600160a01b039091168152602001610111565b348015610228575f5ffd5b506100cc610237366004610c40565b610513565b348015610247575f5ffd5b5030610205565b348015610259575f5ffd5b5061026261057c565b604051610111989796959493929190610efc565b348015610281575f5ffd5b50610205610658565b348015610295575f5ffd5b506100cc6102a4366004610f7c565b61067c565b3480156102b4575f5ffd5b506101636102c336600461107c565b63bc197c8160e01b95945050505050565b3480156102df575f5ffd5b506101ba6106db565b3480156102f3575f5ffd5b506100cc61030236600461114b565b610757565b348015610312575f5ffd5b5061016361032136600461120f565b63f23a6e6160e01b95945050505050565b34801561033d575f5ffd5b506100cc61034c366004610c40565b61083d565b5f6001600160e01b031982166301ffc9a760e01b148061038157506001600160e01b031982166306608bdf60e21b145b8061039c57506001600160e01b03198216630b135d3f60e11b145b806103b757506001600160e01b03198216630271189760e51b145b806103d257506001600160e01b03198216630a85bd0160e11b145b92915050565b5f6103e38383610897565b6103f5576001600160e01b03196103fe565b630b135d3f60e11b5b9392505050565b5f61040e6108b4565b6104188484610916565b90506103fe82610978565b61042b6109bd565b805f5b8181101561050d573684848381811061044957610449611262565b905060200281019061045b9190611276565b90505f6104b961046e6020840184610c40565b60208401356104806040860186611294565b8080601f0160208091040260200160405190810160405280939291908181526020018383808284375f920191909152505050505a6109d8565b90508061050357836001036104d5576104d06109ee565b610503565b826104df5f610a01565b604051635a15467560e01b81526004016104fa9291906112dd565b60405180910390fd5b505060010161042e565b50505050565b333014610532576040516282b42960e81b815260040160405180910390fd5b6001600160a01b0381165f81815260036020908152604091829020805460ff1916600190811790915591519182525f51602061144b5f395f51905f5291015b60405180910390a250565b600180546002805460ff808416946101008504821694620100008104831694630100000082049093169365ffffffffffff600160201b8304811694600160501b8404821694600160801b90940490911692916105d7906112fd565b80601f0160208091040260200160405190810160405280929190818152602001828054610603906112fd565b801561064e5780601f106106255761010080835404028352916020019161064e565b820191905f5260205f20905b81548152906001019060200180831161063157829003601f168201915b5050505050905088565b7f000000000000000000000000000000000000000000000000000000000000000090565b6106846109bd565b5f6106c5858585858080601f0160208091040260200160405190810160405280939291908181526020018383808284375f920191909152505050505a6109d8565b9050806106d4576106d46109ee565b5050505050565b5f6106e4610658565b604051631aab3f0d60e11b81523060048201525f60248201526001600160a01b0391909116906335567e1a90604401602060405180830381865afa15801561072e573d5f5f3e3d5ffd5b505050506040513d601f19601f820116820180604052508101906107529190611335565b905090565b3330148015906107765750335f9081526003602052604090205460ff16155b15610793576040516282b42960e81b815260040160405180910390fd5b805160018054909190829060ff1916818360038111156107b5576107b5610eba565b0217905550805460208301516040840151606085015162010100610100600160501b0319909416600160201b65ffffffffffff948516021793909317600160501b600160b01b031916600160501b9183169190910265ffffffffffff60801b191617600160801b9190921602178155608082015160018201906108389082611390565b505050565b33301461085c576040516282b42960e81b815260040160405180910390fd5b6001600160a01b0381165f818152600360209081526040808320805460ff19169055519182525f51602061144b5f395f51905f529101610571565b5f306108a38484610a32565b6001600160a01b0316149392505050565b6108bc610658565b6001600160a01b0316336001600160a01b03161433306108da610658565b9091926108385760405163fe34a6d360e01b81526001600160a01b039384166004820152918316602483015290911660448201526064016104fa565b5f61096282610929610100860186611294565b8080601f0160208091040260200160405190810160405280939291908181526020018383808284375f9201919091525061089792505050565b61096d5760016103fe565b505f92915050565b50565b8015610975576040515f90339083908381818185875af1925050503d805f81146106d4576040519150601f19603f3d011682016040523d82523d5f602084013e6106d4565b333014806109ce57506108bc610658565b33306108da610658565b5f5f5f845160208601878987f195945050505050565b6109ff6109fa5f610a01565b610a5a565b565b60603d8215610a155782811115610a155750815b604051602082018101604052818152815f602083013e9392505050565b5f5f5f5f610a408686610a62565b925092509250610a508282610aab565b5090949350505050565b805160208201fd5b5f5f5f8351604103610a99576020840151604085015160608601515f1a610a8b88828585610b67565b955095509550505050610aa4565b505081515f91506002905b9250925092565b5f826003811115610abe57610abe610eba565b03610ac7575050565b6001826003811115610adb57610adb610eba565b03610af95760405163f645eedf60e01b815260040160405180910390fd5b6002826003811115610b0d57610b0d610eba565b03610b2e5760405163fce698f760e01b8152600481018290526024016104fa565b6003826003811115610b4257610b42610eba565b03610b63576040516335e2f38360e21b8152600481018290526024016104fa565b5050565b5f80806fa2a8918ca85bafe22016d0b997e4df60600160ff1b03841115610b9657505f91506003905082610c1b565b604080515f808252602082018084528a905260ff891692820192909252606081018790526080810186905260019060a0016020604051602081039080840390855afa158015610be7573d5f5f3e3d5ffd5b5050604051601f1901519150506001600160a01b038116610c1257505f925060019150829050610c1b565b92505f91508190505b9450945094915050565b80356001600160a01b0381168114610c3b575f5ffd5b919050565b5f60208284031215610c50575f5ffd5b6103fe82610c25565b5f60208284031215610c69575f5ffd5b81356001600160e01b0319811681146103fe575f5ffd5b634e487b7160e01b5f52604160045260245ffd5b60405160c081016001600160401b0381118282101715610cb657610cb6610c80565b60405290565b604051601f8201601f191681016001600160401b0381118282101715610ce457610ce4610c80565b604052919050565b5f82601f830112610cfb575f5ffd5b81356001600160401b03811115610d1457610d14610c80565b610d27601f8201601f1916602001610cbc565b818152846020838601011115610d3b575f5ffd5b816020850160208301375f918101602001919091529392505050565b5f5f5f5f60808587031215610d6a575f5ffd5b610d7385610c25565b9350610d8160208601610c25565b92506040850135915060608501356001600160401b03811115610da2575f5ffd5b610dae87828801610cec565b91505092959194509250565b5f5f60408385031215610dcb575f5ffd5b8235915060208301356001600160401b03811115610de7575f5ffd5b610df385828601610cec565b9150509250929050565b5f5f5f60608486031215610e0f575f5ffd5b83356001600160401b03811115610e24575f5ffd5b84016101208187031215610e36575f5ffd5b95602085013595506040909401359392505050565b5f5f60208385031215610e5c575f5ffd5b82356001600160401b03811115610e71575f5ffd5b8301601f81018513610e81575f5ffd5b80356001600160401b03811115610e96575f5ffd5b8560208260051b8401011115610eaa575f5ffd5b6020919091019590945092505050565b634e487b7160e01b5f52602160045260245ffd5b5f81518084528060208401602086015e5f602082860101526020601f19601f83011685010191505092915050565b5f60048a10610f1957634e487b7160e01b5f52602160045260245ffd5b89825288151560208301528715156040830152861515606083015265ffffffffffff8681166080840152851660a083015265ffffffffffff841660c083015261010060e0830152610f6e610100830184610ece565b9a9950505050505050505050565b5f5f5f5f60608587031215610f8f575f5ffd5b610f9885610c25565b93506020850135925060408501356001600160401b03811115610fb9575f5ffd5b8501601f81018713610fc9575f5ffd5b80356001600160401b03811115610fde575f5ffd5b876020828401011115610fef575f5ffd5b949793965060200194505050565b5f82601f83011261100c575f5ffd5b81356001600160401b0381111561102557611025610c80565b8060051b61103560208201610cbc565b91825260208185018101929081019086841115611050575f5ffd5b6020860192505b83831015611072578235825260209283019290910190611057565b9695505050505050565b5f5f5f5f5f60a08688031215611090575f5ffd5b61109986610c25565b94506110a760208701610c25565b935060408601356001600160401b038111156110c1575f5ffd5b6110cd88828901610ffd565b93505060608601356001600160401b038111156110e8575f5ffd5b6110f488828901610ffd565b92505060808601356001600160401b0381111561110f575f5ffd5b61111b88828901610cec565b9150509295509295909350565b803565ffffffffffff81168114610c3b575f5ffd5b803560028110610c3b575f5ffd5b5f6020828403121561115b575f5ffd5b81356001600160401b03811115611170575f5ffd5b820160c08185031215611181575f5ffd5b611189610c94565b813560048110611197575f5ffd5b81526111a560208301611128565b60208201526111b660408301611128565b60408201526111c760608301611128565b606082015260808201356001600160401b038111156111e4575f5ffd5b6111f086828501610cec565b60808301525061120260a0830161113d565b60a0820152949350505050565b5f5f5f5f5f60a08688031215611223575f5ffd5b61122c86610c25565b945061123a60208701610c25565b9350604086013592506060860135915060808601356001600160401b0381111561110f575f5ffd5b634e487b7160e01b5f52603260045260245ffd5b5f8235605e1983360301811261128a575f5ffd5b9190910192915050565b5f5f8335601e198436030181126112a9575f5ffd5b8301803591506001600160401b038211156112c2575f5ffd5b6020019150368190038213156112d6575f5ffd5b9250929050565b828152604060208201525f6112f56040830184610ece565b949350505050565b600181811c9082168061131157607f821691505b60208210810361132f57634e487b7160e01b5f52602260045260245ffd5b50919050565b5f60208284031215611345575f5ffd5b5051919050565b601f82111561083857805f5260205f20601f840160051c810160208510156113715750805b601f840160051c820191505b818110156106d4575f815560010161137d565b81516001600160401b038111156113a9576113a9610c80565b6113bd816113b784546112fd565b8461134c565b6020601f8211600181146113ef575f83156113d85750848201515b5f19600385901b1c1916600184901b1784556106d4565b5f84815260208120601f198516915b8281101561141e57878501518255602094850194600190920191016113fe565b508482101561143b57868401515f19600387901b60f8161c191681555b50505050600190811b0190555056feee43f50d9226e03f9c8e33e6c94d3e3e550a03c9c7ffb835d8c268cf10aa3225000000000000000000000000433709009b8330fda32311df1c2afa402ed8d009";

        (bool s, bytes memory r) = CREATE2_DEPLOYER.call{ value: 0 }(data);
        vm.stopBroadcast();

        require(s, "Failed to send TX");
        console.log(vm.toString(r));
        address deployedAddress = address(uint160(bytes20(r)));
        console.log("Deployed to:", deployedAddress);
        require(SIMPLE_7702 == deployedAddress, "Not Same Address: 0xE70De37053A64B5B2143DA328b5F6DAF8821cbCd");
    }
}
