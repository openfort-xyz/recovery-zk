// SPDX-License-Identifier: MIT

pragma solidity ^0.8.29;

import "lib/forge-std/src/StdJson.sol";
import { Script, console2 as console } from "lib/forge-std/src/Script.sol";
import { Simple7702Recovery } from "contracts/mocks/Simple7702Recovery.sol";

contract DeploySimple7702Recovery is Script {
    bytes32 constant salt = 0x000000000000000000000000000000000000000000000000000000017885423a;
    address private CREATE2_DEPLOYER = 0x4e59b44847b379578588920cA78FbF26c0B4956C;
    address constant SIMPLE7702_RECOVERY = 0x06756dF2e4E5F9a293Fc53022C0B2719633B0719;

    function run() public {
        vm.startBroadcast();
        bytes memory data =
            hex"000000000000000000000000000000000000000000000000000000017885423a60a0604052600180546001600160a01b031916301790553480156020575f5ffd5b5060405161152a38038061152a833981016040819052603d91604d565b6001600160a01b03166080526078565b5f60208284031215605c575f5ffd5b81516001600160a01b03811681146071575f5ffd5b9392505050565b60805161149a6100905f395f610672015261149a5ff3fe6080604052600436106100cc575f3560e01c80629539c7146100ce57806301ffc9a71461011a578063150b7a02146101395780631626ba7e1461017c57806319822f7c1461019b57806334fcd5be146101c8578063880e9cd7146101e75780638ccc84bc1461021d5780638da5cb5b1461023c578063a70e91941461025b578063b0d691fe14610283578063b61d27f614610297578063bc197c81146102b6578063d087d288146102e1578063e49d7870146102f5578063f23a6e6114610314578063f8d1ff461461033f575b005b3480156100d9575f5ffd5b506101056100e8366004610c6f565b6001600160a01b03165f9081526004602052604090205460ff1690565b60405190151581526020015b60405180910390f35b348015610125575f5ffd5b50610105610134366004610c88565b61035e565b348015610144575f5ffd5b50610163610153366004610d86565b630a85bd0160e11b949350505050565b6040516001600160e01b03199091168152602001610111565b348015610187575f5ffd5b50610163610196366004610de9565b6103e5565b3480156101a6575f5ffd5b506101ba6101b5366004610e2c565b610412565b604051908152602001610111565b3480156101d3575f5ffd5b506100cc6101e2366004610e7a565b610430565b3480156101f2575f5ffd5b505f54610205906001600160a01b031681565b6040516001600160a01b039091168152602001610111565b348015610228575f5ffd5b506100cc610237366004610c6f565b610520565b348015610247575f5ffd5b50600154610205906001600160a01b031681565b348015610266575f5ffd5b5061026f610594565b604051610111989796959493929190610f2b565b34801561028e575f5ffd5b50610205610670565b3480156102a2575f5ffd5b506100cc6102b1366004610fab565b610694565b3480156102c1575f5ffd5b506101636102d03660046110ab565b63bc197c8160e01b95945050505050565b3480156102ec575f5ffd5b506101ba6106f3565b348015610300575f5ffd5b506100cc61030f36600461117a565b61076f565b34801561031f575f5ffd5b5061016361032e36600461123e565b63f23a6e6160e01b95945050505050565b34801561034a575f5ffd5b506100cc610359366004610c6f565b610861565b5f6001600160e01b031982166301ffc9a760e01b148061038e57506001600160e01b031982166306608bdf60e21b145b806103a957506001600160e01b03198216630b135d3f60e11b145b806103c457506001600160e01b03198216630271189760e51b145b806103df57506001600160e01b03198216630a85bd0160e11b145b92915050565b5f6103f083836108c6565b610402576001600160e01b031961040b565b630b135d3f60e11b5b9392505050565b5f61041b6108e3565b6104258484610945565b905061040b826109a7565b6104386109ec565b805f5b8181101561051a573684848381811061045657610456611291565b905060200281019061046891906112a5565b90505f6104c661047b6020840184610c6f565b602084013561048d60408601866112c3565b8080601f0160208091040260200160405190810160405280939291908181526020018383808284375f920191909152505050505a610a07565b90508061051057836001036104e2576104dd610a1d565b610510565b826104ec5f610a30565b604051635a15467560e01b815260040161050792919061130c565b60405180910390fd5b505060010161043b565b50505050565b6001546001600160a01b0316331461054a576040516282b42960e81b815260040160405180910390fd5b6001600160a01b0381165f81815260046020908152604091829020805460ff1916600190811790915591519182525f51602061147a5f395f51905f5291015b60405180910390a250565b600280546003805460ff808416946101008504821694620100008104831694630100000082049093169365ffffffffffff600160201b8304811694600160501b8404821694600160801b90940490911692916105ef9061132c565b80601f016020809104026020016040519081016040528092919081815260200182805461061b9061132c565b80156106665780601f1061063d57610100808354040283529160200191610666565b820191905f5260205f20905b81548152906001019060200180831161064957829003601f168201915b5050505050905088565b7f000000000000000000000000000000000000000000000000000000000000000090565b61069c6109ec565b5f6106dd858585858080601f0160208091040260200160405190810160405280939291908181526020018383808284375f920191909152505050505a610a07565b9050806106ec576106ec610a1d565b5050505050565b5f6106fc610670565b604051631aab3f0d60e11b81523060048201525f60248201526001600160a01b0391909116906335567e1a90604401602060405180830381865afa158015610746573d5f5f3e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061076a9190611364565b905090565b6001546001600160a01b031633148015906107995750335f9081526004602052604090205460ff16155b156107b6576040516282b42960e81b815260040160405180910390fd5b805160028054909190829060ff191660018360038111156107d9576107d9610ee9565b0217905550805460208301516040840151606085015162010100610100600160501b0319909416600160201b65ffffffffffff948516021793909317600160501b600160b01b031916600160501b9183169190910265ffffffffffff60801b191617600160801b91909216021781556080820151600182019061085c90826113bf565b505050565b6001546001600160a01b0316331461088b576040516282b42960e81b815260040160405180910390fd5b6001600160a01b0381165f818152600460209081526040808320805460ff19169055519182525f51602061147a5f395f51905f529101610589565b5f306108d28484610a61565b6001600160a01b0316149392505050565b6108eb610670565b6001600160a01b0316336001600160a01b0316143330610909610670565b90919261085c5760405163fe34a6d360e01b81526001600160a01b03938416600482015291831660248301529091166044820152606401610507565b5f610991826109586101008601866112c3565b8080601f0160208091040260200160405190810160405280939291908181526020018383808284375f920191909152506108c692505050565b61099c57600161040b565b505f92915050565b50565b80156109a4576040515f90339083908381818185875af1925050503d805f81146106ec576040519150601f19603f3d011682016040523d82523d5f602084013e6106ec565b333014806109fd57506108eb610670565b3330610909610670565b5f5f5f845160208601878987f195945050505050565b610a2e610a295f610a30565b610a89565b565b60603d8215610a445782811115610a445750815b604051602082018101604052818152815f602083013e9392505050565b5f5f5f5f610a6f8686610a91565b925092509250610a7f8282610ada565b5090949350505050565b805160208201fd5b5f5f5f8351604103610ac8576020840151604085015160608601515f1a610aba88828585610b96565b955095509550505050610ad3565b505081515f91506002905b9250925092565b5f826003811115610aed57610aed610ee9565b03610af6575050565b6001826003811115610b0a57610b0a610ee9565b03610b285760405163f645eedf60e01b815260040160405180910390fd5b6002826003811115610b3c57610b3c610ee9565b03610b5d5760405163fce698f760e01b815260048101829052602401610507565b6003826003811115610b7157610b71610ee9565b03610b92576040516335e2f38360e21b815260048101829052602401610507565b5050565b5f80806fa2a8918ca85bafe22016d0b997e4df60600160ff1b03841115610bc557505f91506003905082610c4a565b604080515f808252602082018084528a905260ff891692820192909252606081018790526080810186905260019060a0016020604051602081039080840390855afa158015610c16573d5f5f3e3d5ffd5b5050604051601f1901519150506001600160a01b038116610c4157505f925060019150829050610c4a565b92505f91508190505b9450945094915050565b80356001600160a01b0381168114610c6a575f5ffd5b919050565b5f60208284031215610c7f575f5ffd5b61040b82610c54565b5f60208284031215610c98575f5ffd5b81356001600160e01b03198116811461040b575f5ffd5b634e487b7160e01b5f52604160045260245ffd5b60405160c081016001600160401b0381118282101715610ce557610ce5610caf565b60405290565b604051601f8201601f191681016001600160401b0381118282101715610d1357610d13610caf565b604052919050565b5f82601f830112610d2a575f5ffd5b81356001600160401b03811115610d4357610d43610caf565b610d56601f8201601f1916602001610ceb565b818152846020838601011115610d6a575f5ffd5b816020850160208301375f918101602001919091529392505050565b5f5f5f5f60808587031215610d99575f5ffd5b610da285610c54565b9350610db060208601610c54565b92506040850135915060608501356001600160401b03811115610dd1575f5ffd5b610ddd87828801610d1b565b91505092959194509250565b5f5f60408385031215610dfa575f5ffd5b8235915060208301356001600160401b03811115610e16575f5ffd5b610e2285828601610d1b565b9150509250929050565b5f5f5f60608486031215610e3e575f5ffd5b83356001600160401b03811115610e53575f5ffd5b84016101208187031215610e65575f5ffd5b95602085013595506040909401359392505050565b5f5f60208385031215610e8b575f5ffd5b82356001600160401b03811115610ea0575f5ffd5b8301601f81018513610eb0575f5ffd5b80356001600160401b03811115610ec5575f5ffd5b8560208260051b8401011115610ed9575f5ffd5b6020919091019590945092505050565b634e487b7160e01b5f52602160045260245ffd5b5f81518084528060208401602086015e5f602082860101526020601f19601f83011685010191505092915050565b5f60048a10610f4857634e487b7160e01b5f52602160045260245ffd5b89825288151560208301528715156040830152861515606083015265ffffffffffff8681166080840152851660a083015265ffffffffffff841660c083015261010060e0830152610f9d610100830184610efd565b9a9950505050505050505050565b5f5f5f5f60608587031215610fbe575f5ffd5b610fc785610c54565b93506020850135925060408501356001600160401b03811115610fe8575f5ffd5b8501601f81018713610ff8575f5ffd5b80356001600160401b0381111561100d575f5ffd5b87602082840101111561101e575f5ffd5b949793965060200194505050565b5f82601f83011261103b575f5ffd5b81356001600160401b0381111561105457611054610caf565b8060051b61106460208201610ceb565b9182526020818501810192908101908684111561107f575f5ffd5b6020860192505b838310156110a1578235825260209283019290910190611086565b9695505050505050565b5f5f5f5f5f60a086880312156110bf575f5ffd5b6110c886610c54565b94506110d660208701610c54565b935060408601356001600160401b038111156110f0575f5ffd5b6110fc8882890161102c565b93505060608601356001600160401b03811115611117575f5ffd5b6111238882890161102c565b92505060808601356001600160401b0381111561113e575f5ffd5b61114a88828901610d1b565b9150509295509295909350565b803565ffffffffffff81168114610c6a575f5ffd5b803560028110610c6a575f5ffd5b5f6020828403121561118a575f5ffd5b81356001600160401b0381111561119f575f5ffd5b820160c081850312156111b0575f5ffd5b6111b8610cc3565b8135600481106111c6575f5ffd5b81526111d460208301611157565b60208201526111e560408301611157565b60408201526111f660608301611157565b606082015260808201356001600160401b03811115611213575f5ffd5b61121f86828501610d1b565b60808301525061123160a0830161116c565b60a0820152949350505050565b5f5f5f5f5f60a08688031215611252575f5ffd5b61125b86610c54565b945061126960208701610c54565b9350604086013592506060860135915060808601356001600160401b0381111561113e575f5ffd5b634e487b7160e01b5f52603260045260245ffd5b5f8235605e198336030181126112b9575f5ffd5b9190910192915050565b5f5f8335601e198436030181126112d8575f5ffd5b8301803591506001600160401b038211156112f1575f5ffd5b602001915036819003821315611305575f5ffd5b9250929050565b828152604060208201525f6113246040830184610efd565b949350505050565b600181811c9082168061134057607f821691505b60208210810361135e57634e487b7160e01b5f52602260045260245ffd5b50919050565b5f60208284031215611374575f5ffd5b5051919050565b601f82111561085c57805f5260205f20601f840160051c810160208510156113a05750805b601f840160051c820191505b818110156106ec575f81556001016113ac565b81516001600160401b038111156113d8576113d8610caf565b6113ec816113e6845461132c565b8461137b565b6020601f82116001811461141e575f83156114075750848201515b5f19600385901b1c1916600184901b1784556106ec565b5f84815260208120601f198516915b8281101561144d578785015182556020948501946001909201910161142d565b508482101561146a57868401515f19600387901b60f8161c191681555b50505050600190811b0190555056feee43f50d9226e03f9c8e33e6c94d3e3e550a03c9c7ffb835d8c268cf10aa3225000000000000000000000000433709009b8330fda32311df1c2afa402ed8d009";

        (bool s, bytes memory r) = CREATE2_DEPLOYER.call{ value: 0 }(data);
        vm.stopBroadcast();

        require(s, "Failed to send TX");
        console.log(vm.toString(r));
        address deployedAddress = address(uint160(bytes20(r)));
        console.log("Deployed to:", deployedAddress);
        require(SIMPLE7702_RECOVERY == deployedAddress, "Not Same Address: 0x06756dF2e4E5F9a293Fc53022C0B2719633B0719");
    }
}
