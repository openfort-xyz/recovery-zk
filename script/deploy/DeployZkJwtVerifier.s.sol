// SPDX-License-Identifier: MIT

pragma solidity ^0.8.21;

import "lib/forge-std/src/StdJson.sol";
import { ZkJwtVerifier } from "contracts/verifiers/ZkJwtVerifier.sol";
import { Script, console2 as console } from "lib/forge-std/src/Script.sol";

contract DeployZkJwtVerifier is Script {
    address constant ZKJWT_VERIFIER = 0x1b40956cAB416840b676A30d9a886a856063f7C0;
    address private CREATE2_DEPLOYER = 0x4e59b44847b379578588920cA78FbF26c0B4956C;

    function run() public {
        vm.startBroadcast();
        bytes memory data =
            hex"000000000000000000000000000000000000000000000000000000017885423a60a0604052348015600e575f5ffd5b506040516105c93803806105c9833981016040819052602b91603b565b6001600160a01b03166080526066565b5f60208284031215604a575f5ffd5b81516001600160a01b0381168114605f575f5ffd5b9392505050565b6080516105456100845f395f8181608401526101fc01526105455ff3fe608060405234801561000f575f5ffd5b5060043610610060575f3560e01c80632fc7b151146100645780637d40ea701461007f57806388d5090d146100be5780638cbf00dd146100d25780639398766e146100e1578063de12c640146100e9575b5f5ffd5b61006c601481565b6040519081526020015b60405180910390f35b6100a67f000000000000000000000000000000000000000000000000000000000000000081565b6040516001600160a01b039091168152602001610076565b61006c5f5160206105255f395f51905f5281565b60405160028152602001610076565b61006c601281565b6100fc6100f736600461027e565b61010c565b6040519015158152602001610076565b5f808061011b848601866103a8565b6040805160148082526102a082019092529294509092505f919060208201610280803683370190505090505f5b601281101561018d578281601281106101635761016361044d565b602002015182828151811061017a5761017a61044d565b6020908102919091010152600101610148565b506101a55f5160206105255f395f51905f5288610461565b5f1b816012815181106101ba576101ba61044d565b60200260200101818152505087816013815181106101da576101da61044d565b6020908102919091010152604051633a94343960e21b81526001600160a01b037f0000000000000000000000000000000000000000000000000000000000000000169063ea50d0e4906102339086908590600401610480565b602060405180830381865afa15801561024e573d5f5f3e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061027291906104fe565b98975050505050505050565b5f5f5f5f60608587031215610291575f5ffd5b843593506020850135925060408501356001600160401b038111156102b4575f5ffd5b8501601f810187136102c4575f5ffd5b80356001600160401b038111156102d9575f5ffd5b8760208284010111156102ea575f5ffd5b949793965060200194505050565b634e487b7160e01b5f52604160045260245ffd5b604051601f8201601f191681016001600160401b0381118282101715610334576103346102f8565b604052919050565b5f82601f83011261034b575f5ffd5b60405161024081016001600160401b038111828210171561036e5761036e6102f8565b60405280610240840185811115610383575f5ffd5b845b8181101561039d578035835260209283019201610385565b509195945050505050565b5f5f61026083850312156103ba575f5ffd5b82356001600160401b038111156103cf575f5ffd5b8301601f810185136103df575f5ffd5b80356001600160401b038111156103f8576103f86102f8565b61040b601f8201601f191660200161030c565b81815286602083850101111561041f575f5ffd5b816020840160208301375f60208383010152809450505050610444846020850161033c565b90509250929050565b634e487b7160e01b5f52603260045260245ffd5b5f8261047b57634e487b7160e01b5f52601260045260245ffd5b500690565b604081525f83518060408401528060208601606085015e5f60608285010152601f19601f820116830190506060810160608483030160208501528085518083526080840191506020870193505f92505b808310156104f357835182526020820191506020840193506001830192506104d0565b509695505050505050565b5f6020828403121561050e575f5ffd5b8151801515811461051d575f5ffd5b939250505056fe30644e72e131a029b85045b68181585d2833e84879b9709143e1f593f0000001000000000000000000000000cbe0c0400027d2fb6d1f6a4d5238089ec1592aa4";

        (bool s, bytes memory r) = CREATE2_DEPLOYER.call{ value: 0 }(data);
        vm.stopBroadcast();

        require(s, "Failed to send TX");
        console.log(vm.toString(r));
        address deployedAddress = address(uint160(bytes20(r)));
        console.log("Deployed to:", deployedAddress);

        require(ZKJWT_VERIFIER == deployedAddress, "Not Same Address: 0x1b40956cAB416840b676A30d9a886a856063f7C0");
    }
}
